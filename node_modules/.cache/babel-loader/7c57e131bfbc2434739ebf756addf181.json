{"ast":null,"code":"import _objectSpread from\"/Users/liu550/Desktop/salon_project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/Users/liu550/Desktop/salon_project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/liu550/Desktop/salon_project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/liu550/Desktop/salon_project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/liu550/Desktop/salon_project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/liu550/Desktop/salon_project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/liu550/Desktop/salon_project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from'react';import\"./component.css\";import{connect}from'react-redux';import firebase from'../config/firebaseconfig';import{compose}from'redux';import{firestoreConnect}from'react-redux-firebase';import{startMatchingConversation,changeChat}from'../redux/actions';import Draggable from'react-draggable';import{Rnd}from\"react-rnd\";import Card from\"./design/card.js\";import ProfileCard from'./profilecard.js';var questions=[\"What are you trying to achieve today?\",\"What are your lifelong goals?\",\"What are your short-term goals?\",\"What are your recent struggles?\",\"What do you think we should do to promote racial eqaulity in the society?\",\"What motivates you?\",\"Could you talk more about yourself and your interests?\"];var MatchingWindow=/*#__PURE__*/function(_Component){_inherits(MatchingWindow,_Component);var _super=_createSuper(MatchingWindow);function MatchingWindow(props){var _this;_classCallCheck(this,MatchingWindow);_this=_super.call(this,props);_this.handleSend=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var date,time,message,profile;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();if(document.getElementById(\"matching-message\").value!==\"\"){date=new Date();time=date.getFullYear()+\"-\"+(date.getMonth()+1)+\"-\"+date.getDate()+\" \"+date.getHours()+\":\"+date.getMinutes();message=_this.createMessage(time);profile=_this.props.profile;_this.props.startMatchingConversation(_this.props.buddy.id,_this.props.buddy.profile,profile,message);document.getElementById(\"matching-message\").value=\"\";}case 2:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();_this.createMessage=function(time){var message={};message={time:time,from:_this.props.auth.uid,content:document.getElementById(\"matching-message\").value};return message;};_this.closeMatching=function(e){e.preventDefault();_this.setState({visibility:false});};_this.handleRenderProfile=function(){_this.setState({showProfile:true});};_this.handleHideProfile=function(){_this.setState({showProfile:false});};_this.buddyCard=React.createRef();_this.state={visibility:true,showProfile:false,messages:[],width:600,height:500,x:350,y:20};return _this;}_createClass(MatchingWindow,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;this.newData.scrollTop=this.newData.scrollHeight;var number=Math.floor(Math.random()*questions.length);document.getElementById(\"matching-message\").value=questions[number];if(this.props.chat!==\"\"){firebase.firestore().collection(\"chats\").doc(this.props.chat).get().then(function(doc){_this2.setState({messages:doc.data().messages});});}}},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevprops){var _this3=this;this.newData.scrollTop=this.newData.scrollHeight;var _=require(\"lodash\");if(!_.isEqual(prevprops.chat_history,this.props.chat_history)){var found=this.props.chat_history.find(function(element){return element.id===_this3.props.buddy.id;});if(found!==undefined){this.props.changeChat(found.chat_id);}}if(prevprops.chat!==this.props.chat){firebase.firestore().collection(\"chats\").doc(this.props.chat).get().then(function(doc){_this3.setState({messages:doc.data().messages});});}}},{key:\"componentWillReceiveProps\",value:function componentWillReceiveProps(){var _this4=this;if(this.props.chat!==\"\"){firebase.firestore().collection(\"chats\").doc(this.props.chat).get().then(function(doc){_this4.setState({messages:doc.data().messages});});}}},{key:\"render\",value:function render(){var _this5=this;var chats=this.state.messages;var _this$props=this.props,auth=_this$props.auth,profile=_this$props.profile,buddy=_this$props.buddy;return/*#__PURE__*/React.createElement(\"div\",null,this.state.visibility?/*#__PURE__*/React.createElement(Rnd,{className:\"matching-window\",size:{width:this.state.width,height:this.state.height},enableUserSelectHack:\"false\",position:{x:this.state.x,y:this.state.y,z:1},onDragStop:function onDragStop(e,d){_this5.setState({x:d.x,y:d.y});},onResizeStop:function onResizeStop(e,direction,ref,delta,position){_this5.setState(_objectSpread({width:ref.style.width,height:ref.style.height},position));}},/*#__PURE__*/React.createElement(\"div\",{className:\"matching-window-header\"},this.state.showProfile?/*#__PURE__*/React.createElement(\"div\",{className:\"arrow\"},/*#__PURE__*/React.createElement(ProfileCard,{id:buddy.id})):null,/*#__PURE__*/React.createElement(\"img\",{src:buddy.profile.image,style:{marginLeft:\"5px\",height:\"40px\",width:\"40px\"},ref:this.buddyCard,onMouseOver:this.handleRenderProfile,onMouseOut:this.handleHideProfile}),/*#__PURE__*/React.createElement(\"img\",{src:profile.image,style:{marginLeft:\"5px\",height:\"40px\",width:\"40px\"}}),/*#__PURE__*/React.createElement(\"button\",{className:\"matchingwindow-button\",onClick:function onClick(){return _this5.props.close();},style:{float:\"right\"}},\"x\")),/*#__PURE__*/React.createElement(\"div\",{className:\"matchingwindow-chat\",ref:function ref(_ref2){return _this5.newData=_ref2;}},chats&&chats.map(function(chat){return/*#__PURE__*/React.createElement(\"div\",{className:chat.from===auth.uid?\"me-section\":\"buddy-section\"},/*#__PURE__*/React.createElement(\"div\",{style:chat.from===auth.uid?{display:\"flex\",float:\"right\",clear:\"both\"}:{display:\"flex\",float:\"left\",clear:\"both\"}},/*#__PURE__*/React.createElement(\"img\",{src:chat.from===auth.uid?profile.image:buddy.profile.image,style:{height:\"20px\",width:\"20px\"}}),chat.time),/*#__PURE__*/React.createElement(\"div\",{className:chat.from===auth.uid?\"right-bubble\":\"left-bubble\"},chat.content));})),/*#__PURE__*/React.createElement(\"textarea\",{className:\"matchingwindow-text\",id:\"matching-message\",onMouseDown:function onMouseDown(e){return e.stopPropagation();},required:true}),/*#__PURE__*/React.createElement(\"div\",{className:\"matchingwindow-bottom\"},/*#__PURE__*/React.createElement(\"button\",{className:\"matchingwindow-send\",onClick:this.handleSend,style:{float:\"right\"}},\"Send\"))):null);}}]);return MatchingWindow;}(Component);var mapStateToProps=function mapStateToProps(state){return{chats:state.firestore.ordered.chats,profile:state.firebase.profile,auth:state.firebase.auth,chat_history:state.firestore.ordered.chat_history};};export default compose(connect(mapStateToProps,{startMatchingConversation:startMatchingConversation,changeChat:changeChat}),firestoreConnect(function(props){return[{collection:'chats'},{collection:\"users\",doc:props.auth.uid,subcollections:[{collection:\"chat_history\"}],storeAs:\"chat_history\"}];}))(MatchingWindow);","map":{"version":3,"sources":["/Users/liu550/Desktop/salon_project/src/components/matchingwindow.js"],"names":["React","Component","connect","firebase","compose","firestoreConnect","startMatchingConversation","changeChat","Draggable","Rnd","Card","ProfileCard","questions","MatchingWindow","props","handleSend","e","preventDefault","document","getElementById","value","date","Date","time","getFullYear","getMonth","getDate","getHours","getMinutes","message","createMessage","profile","buddy","id","from","auth","uid","content","closeMatching","setState","visibility","handleRenderProfile","showProfile","handleHideProfile","buddyCard","createRef","state","messages","width","height","x","y","newData","scrollTop","scrollHeight","number","Math","floor","random","length","chat","firestore","collection","doc","get","then","data","prevprops","_","require","isEqual","chat_history","found","find","element","undefined","chat_id","chats","z","d","direction","ref","delta","position","style","image","marginLeft","close","float","map","display","clear","stopPropagation","mapStateToProps","ordered","subcollections","storeAs"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport \"./component.css\";\nimport { connect } from 'react-redux';\nimport firebase from '../config/firebaseconfig';\nimport { compose } from 'redux';\nimport { firestoreConnect } from 'react-redux-firebase';\nimport { startMatchingConversation, changeChat } from '../redux/actions';\nimport Draggable from 'react-draggable';\nimport { Rnd } from \"react-rnd\";\nimport Card from \"./design/card.js\";\nimport ProfileCard from './profilecard.js';\n\nconst questions = [\n    \"What are you trying to achieve today?\",\n    \"What are your lifelong goals?\",\n    \"What are your short-term goals?\",\n    \"What are your recent struggles?\",\n    \"What do you think we should do to promote racial eqaulity in the society?\",\n    \"What motivates you?\",\n    \"Could you talk more about yourself and your interests?\"\n]\n\n\n\nclass MatchingWindow extends Component {\n\n    constructor(props){\n        super(props);\n        this.buddyCard = React.createRef();\n        this.state = {\n            visibility: true,\n            showProfile: false,\n            messages: [],\n            width: 600,\n            height: 500,\n            x: 350,\n            y: 20\n        }\n    }\n\n    componentDidMount() {\n        this.newData.scrollTop = this.newData.scrollHeight;\n        const number = Math.floor(Math.random() * questions.length);\n        document.getElementById(\"matching-message\").value = questions[number];\n        if (this.props.chat !== \"\") {\n            firebase.firestore().collection(\"chats\").doc(this.props.chat).get()\n            .then((doc) => {\n                this.setState({\n                    messages: doc.data().messages\n                })\n            })\n        }\n    }\n\n    \n    componentDidUpdate(prevprops) {\n        this.newData.scrollTop = this.newData.scrollHeight;\n\n        const _ = require(\"lodash\")\n        if (!_.isEqual(prevprops.chat_history, this.props.chat_history)) {\n            const found = this.props.chat_history.find(element => element.id === this.props.buddy.id);\n            if (found !== undefined) {\n                this.props.changeChat(found.chat_id);\n            }\n        }\n        if (prevprops.chat !== this.props.chat) {\n            firebase.firestore().collection(\"chats\").doc(this.props.chat).get()\n            .then((doc) => {\n                this.setState({\n                    messages: doc.data().messages\n                }) \n            })\n        }\n    }\n\n    componentWillReceiveProps() {\n        if (this.props.chat !== \"\") {\n            firebase.firestore().collection(\"chats\").doc(this.props.chat).get()\n            .then((doc) => {\n                this.setState({\n                    messages: doc.data().messages\n                })\n            })\n        }\n    }\n    \n    \n    handleSend = async (e) => {\n        e.preventDefault();\n        if (document.getElementById(\"matching-message\").value !== \"\") {\n        const date = new Date();\n        const time = date.getFullYear() + \"-\" + (date.getMonth() + 1) + \"-\" + date.getDate() + \" \" + date.getHours() + \":\" + date.getMinutes();\n        const message = this.createMessage(time);\n        const { profile } = this.props;\n        this.props.startMatchingConversation(this.props.buddy.id, this.props.buddy.profile, profile, message);\n        document.getElementById(\"matching-message\").value = \"\";\n        }\n      }\n    \n      createMessage = (time) => {\n        let message = {};\n        message = { time: time, from : this.props.auth.uid, content: document.getElementById(\"matching-message\").value };\n        return message;\n      }\n\n      closeMatching = (e) => {\n          e.preventDefault();\n          this.setState({\n              visibility: false\n          })\n      }\n\n      handleRenderProfile = () => {\n          this.setState({\n              showProfile: true\n          })\n      }\n\n      handleHideProfile = () =>{\n          this.setState({\n              showProfile: false\n          })\n      }\n\n\n\n\n\n\n    render() {\n\n        const chats = this.state.messages;\n        const { auth, profile, buddy } = this.props;\n\n\n        return (\n\n            <div>\n\n            { this.state.visibility ?\n            <Rnd\n            className=\"matching-window\"\n            size={{ width: this.state.width, height: this.state.height }}\n            enableUserSelectHack=\"false\"\n            position={{ x: this.state.x, y: this.state.y, z: 1 }}\n            onDragStop={(e, d) => {\n              this.setState({ x: d.x, y: d.y });\n            }}\n            onResizeStop={(e, direction, ref, delta, position) => {\n              this.setState({\n                width: ref.style.width,\n                height: ref.style.height,\n                ...position\n              });\n            }}\n            >\n                    \n                    <div className=\"matching-window-header\">\n                        {this.state.showProfile ? <div className=\"arrow\"><ProfileCard id={buddy.id}/></div> : null}\n                         <img src={buddy.profile.image} style={{ marginLeft: \"5px\", height: \"40px\", width: \"40px\" }} ref={this.buddyCard} onMouseOver={this.handleRenderProfile} onMouseOut={this.handleHideProfile}></img>\n                        <img src={profile.image} style={{ marginLeft: \"5px\", height: \"40px\", width: \"40px\" }}></img>\n                        <button className=\"matchingwindow-button\" onClick={() => this.props.close()} style={{ float: \"right\" }}>x</button>\n                    </div>\n\n                    <div className=\"matchingwindow-chat\" ref={(ref) => this.newData = ref}>\n                    {chats && chats.map((chat) => {\n                        return (\n                            \n                            \n\n                                <div className={ chat.from === auth.uid ? \"me-section\" : \"buddy-section\" }>\n                                    <div style={ chat.from === auth.uid ? { display: \"flex\", float: \"right\", clear: \"both\" } : { display: \"flex\", float : \"left\", clear: \"both\" }}>\n                                    <img src={ chat.from === auth.uid ? profile.image : buddy.profile.image} style={{ height: \"20px\", width: \"20px\" }}></img>\n                                    {chat.time}\n                                    </div>\n\n                                <div className={ chat.from === auth.uid ? \"right-bubble\" : \"left-bubble\" }>\n                                {chat.content}\n                                </div>\n\n\n                               </div>\n                          \n\n                    \n                        );\n                    })}\n                    </div>\n       \n\n                    <textarea className=\"matchingwindow-text\" id=\"matching-message\" onMouseDown={e => e.stopPropagation()} required></textarea>\n\n                <div className=\"matchingwindow-bottom\">\n                    <button className=\"matchingwindow-send\" onClick={this.handleSend} style={{ float: \"right\" }}>Send</button>\n                </div>\n\n            </Rnd>\n            : null }\n            </div>\n        );\n    }\n}\n\nconst mapStateToProps = (state) => {\n    return {\n        chats: state.firestore.ordered.chats,\n        profile: state.firebase.profile,\n        auth: state.firebase.auth,\n        chat_history: state.firestore.ordered.chat_history\n    }\n}\n\n\nexport default compose(\nconnect(mapStateToProps, {startMatchingConversation, changeChat}),\nfirestoreConnect(props => {\n    return [\n        { collection: 'chats' },\n        {\n            collection: \"users\",\n            doc: props.auth.uid,\n            subcollections: [{ collection: \"chat_history\" }],\n            storeAs: \"chat_history\"\n        }\n    ]\n})\n)(MatchingWindow);"]},"metadata":{},"sourceType":"module"}