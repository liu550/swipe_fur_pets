{"ast":null,"code":"var _jsxFileName = \"/Users/liu550/Desktop/salon_project/src/components/matchingwindow.js\";\nimport React, { Component } from 'react';\nimport \"./component.css\";\nimport { connect } from 'react-redux';\nimport firebase from '../config/firebaseconfig';\nimport { compose } from 'redux';\nimport { firestoreConnect } from 'react-redux-firebase';\nimport { startMatchingConversation, changeChat } from '../redux/actions';\nimport Draggable from 'react-draggable';\nimport { Rnd } from \"react-rnd\";\nimport Card from \"./design/card.js\";\nimport ProfileCard from './profilecard.js';\nconst questions = [\"What are you trying to achieve today?\", \"What are your lifelong goals?\", \"What are your short-term goals?\", \"What are your recent struggles?\", \"What do you think we should do to promote racial eqaulity in the society?\", \"What motivates you?\", \"Could you talk more about yourself and your interests?\"];\n\nclass MatchingWindow extends Component {\n  constructor(props) {\n    super(props);\n\n    this.handleSend = async e => {\n      e.preventDefault();\n\n      if (document.getElementById(\"matching-message\").value !== \"\") {\n        const date = new Date();\n        const time = date.getFullYear() + \"-\" + (date.getMonth() + 1) + \"-\" + date.getDate() + \" \" + date.getHours() + \":\" + date.getMinutes();\n        const message = this.createMessage(time);\n        const {\n          profile\n        } = this.props;\n        this.props.startMatchingConversation(this.props.buddy.id, this.props.buddy.profile, profile, message);\n        document.getElementById(\"matching-message\").value = \"\";\n      }\n    };\n\n    this.createMessage = time => {\n      let message = {};\n      message = {\n        time: time,\n        from: this.props.auth.uid,\n        content: document.getElementById(\"matching-message\").value\n      };\n      return message;\n    };\n\n    this.closeMatching = e => {\n      e.preventDefault();\n      this.setState({\n        visibility: false\n      });\n    };\n\n    this.handleRenderProfile = () => {\n      this.setState({\n        showProfile: true\n      });\n    };\n\n    this.handleHideProfile = () => {\n      this.setState({\n        showProfile: false\n      });\n    };\n\n    this.buddyCard = React.createRef();\n    this.state = {\n      visibility: true,\n      showProfile: false,\n      messages: [],\n      width: 600,\n      height: 500,\n      x: 350,\n      y: 20\n    };\n  }\n\n  componentDidMount() {\n    this.newData.scrollTop = this.newData.scrollHeight;\n    const number = Math.floor(Math.random() * questions.length);\n    document.getElementById(\"matching-message\").value = questions[number];\n\n    if (this.props.chat !== \"\") {\n      firebase.firestore().collection(\"chats\").doc(this.props.chat).get().then(doc => {\n        this.setState({\n          messages: doc.data().messages\n        });\n      });\n    }\n  }\n\n  componentDidUpdate(prevprops) {\n    this.newData.scrollTop = this.newData.scrollHeight;\n\n    const _ = require(\"lodash\");\n\n    if (!_.isEqual(prevprops.chat_history, this.props.chat_history)) {\n      const found = this.props.chat_history.find(element => element.id === this.props.buddy.id);\n\n      if (found !== undefined) {\n        this.props.changeChat(found.chat_id);\n      }\n    }\n\n    if (prevprops.chat !== this.props.chat) {\n      firebase.firestore().collection(\"chats\").doc(this.props.chat).get().then(doc => {\n        this.setState({\n          messages: doc.data().messages\n        });\n      });\n    }\n  }\n\n  componentWillReceiveProps() {\n    if (this.props.chat !== \"\") {\n      firebase.firestore().collection(\"chats\").doc(this.props.chat).get().then(doc => {\n        this.setState({\n          messages: doc.data().messages\n        });\n      });\n    }\n  }\n\n  render() {\n    const chats = this.state.messages;\n    const {\n      auth,\n      profile,\n      buddy\n    } = this.props;\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 138,\n        columnNumber: 13\n      }\n    }, this.state.visibility ? /*#__PURE__*/React.createElement(Rnd, {\n      className: \"matching-window\",\n      size: {\n        width: this.state.width,\n        height: this.state.height\n      },\n      enableUserSelectHack: \"false\",\n      position: {\n        x: this.state.x,\n        y: this.state.y,\n        z: 1\n      },\n      onDragStop: (e, d) => {\n        this.setState({\n          x: d.x,\n          y: d.y\n        });\n      },\n      onResizeStop: (e, direction, ref, delta, position) => {\n        this.setState({\n          width: ref.style.width,\n          height: ref.style.height,\n          ...position\n        });\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 141,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"matching-window-header\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 21\n      }\n    }, this.state.showProfile ? /*#__PURE__*/React.createElement(\"div\", {\n      className: \"arrow\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 159,\n        columnNumber: 51\n      }\n    }, /*#__PURE__*/React.createElement(ProfileCard, {\n      id: buddy.id,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 159,\n        columnNumber: 74\n      }\n    })) : null, /*#__PURE__*/React.createElement(\"img\", {\n      src: buddy.profile.image,\n      style: {\n        marginLeft: \"5px\",\n        height: \"40px\",\n        width: \"40px\"\n      },\n      ref: this.buddyCard,\n      onMouseOver: this.handleRenderProfile,\n      onMouseOut: this.handleHideProfile,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 26\n      }\n    }), /*#__PURE__*/React.createElement(\"img\", {\n      src: profile.image,\n      style: {\n        marginLeft: \"5px\",\n        height: \"40px\",\n        width: \"40px\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 161,\n        columnNumber: 25\n      }\n    }), /*#__PURE__*/React.createElement(\"button\", {\n      className: \"matchingwindow-button\",\n      onClick: () => this.props.close(),\n      style: {\n        float: \"right\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 25\n      }\n    }, \"x\")), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"matchingwindow-chat\",\n      ref: ref => this.newData = ref,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 165,\n        columnNumber: 21\n      }\n    }, chats && chats.map(chat => {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: chat.from === auth.uid ? \"me-section\" : \"buddy-section\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 171,\n          columnNumber: 33\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        style: chat.from === auth.uid ? {\n          display: \"flex\",\n          float: \"right\",\n          clear: \"both\"\n        } : {\n          display: \"flex\",\n          float: \"left\",\n          clear: \"both\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 172,\n          columnNumber: 37\n        }\n      }, /*#__PURE__*/React.createElement(\"img\", {\n        src: chat.from === auth.uid ? profile.image : buddy.profile.image,\n        style: {\n          height: \"20px\",\n          width: \"20px\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 173,\n          columnNumber: 37\n        }\n      }), chat.time), /*#__PURE__*/React.createElement(\"div\", {\n        className: chat.from === auth.uid ? \"right-bubble\" : \"left-bubble\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 177,\n          columnNumber: 33\n        }\n      }, chat.content));\n    })), /*#__PURE__*/React.createElement(\"textarea\", {\n      className: \"matchingwindow-text\",\n      id: \"matching-message\",\n      onMouseDown: e => e.stopPropagation(),\n      required: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 191,\n        columnNumber: 21\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"matchingwindow-bottom\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 193,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      className: \"matchingwindow-send\",\n      onClick: this.handleSend,\n      style: {\n        float: \"right\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 194,\n        columnNumber: 21\n      }\n    }, \"Send\"))) : null);\n  }\n\n}\n\nconst mapStateToProps = state => {\n  return {\n    chats: state.firestore.ordered.chats,\n    profile: state.firebase.profile,\n    auth: state.firebase.auth,\n    chat_history: state.firestore.ordered.chat_history\n  };\n};\n\nexport default compose(connect(mapStateToProps, {\n  startMatchingConversation,\n  changeChat\n}), firestoreConnect(props => {\n  return [{\n    collection: 'chats'\n  }, {\n    collection: \"users\",\n    doc: props.auth.uid,\n    subcollections: [{\n      collection: \"chat_history\"\n    }],\n    storeAs: \"chat_history\"\n  }];\n}))(MatchingWindow);","map":{"version":3,"sources":["/Users/liu550/Desktop/salon_project/src/components/matchingwindow.js"],"names":["React","Component","connect","firebase","compose","firestoreConnect","startMatchingConversation","changeChat","Draggable","Rnd","Card","ProfileCard","questions","MatchingWindow","constructor","props","handleSend","e","preventDefault","document","getElementById","value","date","Date","time","getFullYear","getMonth","getDate","getHours","getMinutes","message","createMessage","profile","buddy","id","from","auth","uid","content","closeMatching","setState","visibility","handleRenderProfile","showProfile","handleHideProfile","buddyCard","createRef","state","messages","width","height","x","y","componentDidMount","newData","scrollTop","scrollHeight","number","Math","floor","random","length","chat","firestore","collection","doc","get","then","data","componentDidUpdate","prevprops","_","require","isEqual","chat_history","found","find","element","undefined","chat_id","componentWillReceiveProps","render","chats","z","d","direction","ref","delta","position","style","image","marginLeft","close","float","map","display","clear","stopPropagation","mapStateToProps","ordered","subcollections","storeAs"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport \"./component.css\";\nimport { connect } from 'react-redux';\nimport firebase from '../config/firebaseconfig';\nimport { compose } from 'redux';\nimport { firestoreConnect } from 'react-redux-firebase';\nimport { startMatchingConversation, changeChat } from '../redux/actions';\nimport Draggable from 'react-draggable';\nimport { Rnd } from \"react-rnd\";\nimport Card from \"./design/card.js\";\nimport ProfileCard from './profilecard.js';\n\nconst questions = [\n    \"What are you trying to achieve today?\",\n    \"What are your lifelong goals?\",\n    \"What are your short-term goals?\",\n    \"What are your recent struggles?\",\n    \"What do you think we should do to promote racial eqaulity in the society?\",\n    \"What motivates you?\",\n    \"Could you talk more about yourself and your interests?\"\n]\n\n\n\nclass MatchingWindow extends Component {\n\n    constructor(props){\n        super(props);\n        this.buddyCard = React.createRef();\n        this.state = {\n            visibility: true,\n            showProfile: false,\n            messages: [],\n            width: 600,\n            height: 500,\n            x: 350,\n            y: 20\n        }\n    }\n\n    componentDidMount() {\n        this.newData.scrollTop = this.newData.scrollHeight;\n        const number = Math.floor(Math.random() * questions.length);\n        document.getElementById(\"matching-message\").value = questions[number];\n        if (this.props.chat !== \"\") {\n            firebase.firestore().collection(\"chats\").doc(this.props.chat).get()\n            .then((doc) => {\n                this.setState({\n                    messages: doc.data().messages\n                })\n            })\n        }\n    }\n\n    \n    componentDidUpdate(prevprops) {\n        this.newData.scrollTop = this.newData.scrollHeight;\n\n        const _ = require(\"lodash\")\n        if (!_.isEqual(prevprops.chat_history, this.props.chat_history)) {\n            const found = this.props.chat_history.find(element => element.id === this.props.buddy.id);\n            if (found !== undefined) {\n                this.props.changeChat(found.chat_id);\n            }\n        }\n        if (prevprops.chat !== this.props.chat) {\n            firebase.firestore().collection(\"chats\").doc(this.props.chat).get()\n            .then((doc) => {\n                this.setState({\n                    messages: doc.data().messages\n                }) \n            })\n        }\n    }\n\n    componentWillReceiveProps() {\n        if (this.props.chat !== \"\") {\n            firebase.firestore().collection(\"chats\").doc(this.props.chat).get()\n            .then((doc) => {\n                this.setState({\n                    messages: doc.data().messages\n                })\n            })\n        }\n    }\n    \n    \n    handleSend = async (e) => {\n        e.preventDefault();\n        if (document.getElementById(\"matching-message\").value !== \"\") {\n        const date = new Date();\n        const time = date.getFullYear() + \"-\" + (date.getMonth() + 1) + \"-\" + date.getDate() + \" \" + date.getHours() + \":\" + date.getMinutes();\n        const message = this.createMessage(time);\n        const { profile } = this.props;\n        this.props.startMatchingConversation(this.props.buddy.id, this.props.buddy.profile, profile, message);\n        document.getElementById(\"matching-message\").value = \"\";\n        }\n      }\n    \n      createMessage = (time) => {\n        let message = {};\n        message = { time: time, from : this.props.auth.uid, content: document.getElementById(\"matching-message\").value };\n        return message;\n      }\n\n      closeMatching = (e) => {\n          e.preventDefault();\n          this.setState({\n              visibility: false\n          })\n      }\n\n      handleRenderProfile = () => {\n          this.setState({\n              showProfile: true\n          })\n      }\n\n      handleHideProfile = () =>{\n          this.setState({\n              showProfile: false\n          })\n      }\n\n\n\n\n\n\n    render() {\n\n        const chats = this.state.messages;\n        const { auth, profile, buddy } = this.props;\n\n\n        return (\n\n            <div>\n\n            { this.state.visibility ?\n            <Rnd\n            className=\"matching-window\"\n            size={{ width: this.state.width, height: this.state.height }}\n            enableUserSelectHack=\"false\"\n            position={{ x: this.state.x, y: this.state.y, z: 1 }}\n            onDragStop={(e, d) => {\n              this.setState({ x: d.x, y: d.y });\n            }}\n            onResizeStop={(e, direction, ref, delta, position) => {\n              this.setState({\n                width: ref.style.width,\n                height: ref.style.height,\n                ...position\n              });\n            }}\n            >\n                    \n                    <div className=\"matching-window-header\">\n                        {this.state.showProfile ? <div className=\"arrow\"><ProfileCard id={buddy.id}/></div> : null}\n                         <img src={buddy.profile.image} style={{ marginLeft: \"5px\", height: \"40px\", width: \"40px\" }} ref={this.buddyCard} onMouseOver={this.handleRenderProfile} onMouseOut={this.handleHideProfile}></img>\n                        <img src={profile.image} style={{ marginLeft: \"5px\", height: \"40px\", width: \"40px\" }}></img>\n                        <button className=\"matchingwindow-button\" onClick={() => this.props.close()} style={{ float: \"right\" }}>x</button>\n                    </div>\n\n                    <div className=\"matchingwindow-chat\" ref={(ref) => this.newData = ref}>\n                    {chats && chats.map((chat) => {\n                        return (\n                            \n                            \n\n                                <div className={ chat.from === auth.uid ? \"me-section\" : \"buddy-section\" }>\n                                    <div style={ chat.from === auth.uid ? { display: \"flex\", float: \"right\", clear: \"both\" } : { display: \"flex\", float : \"left\", clear: \"both\" }}>\n                                    <img src={ chat.from === auth.uid ? profile.image : buddy.profile.image} style={{ height: \"20px\", width: \"20px\" }}></img>\n                                    {chat.time}\n                                    </div>\n\n                                <div className={ chat.from === auth.uid ? \"right-bubble\" : \"left-bubble\" }>\n                                {chat.content}\n                                </div>\n\n\n                               </div>\n                          \n\n                    \n                        );\n                    })}\n                    </div>\n       \n\n                    <textarea className=\"matchingwindow-text\" id=\"matching-message\" onMouseDown={e => e.stopPropagation()} required></textarea>\n\n                <div className=\"matchingwindow-bottom\">\n                    <button className=\"matchingwindow-send\" onClick={this.handleSend} style={{ float: \"right\" }}>Send</button>\n                </div>\n\n            </Rnd>\n            : null }\n            </div>\n        );\n    }\n}\n\nconst mapStateToProps = (state) => {\n    return {\n        chats: state.firestore.ordered.chats,\n        profile: state.firebase.profile,\n        auth: state.firebase.auth,\n        chat_history: state.firestore.ordered.chat_history\n    }\n}\n\n\nexport default compose(\nconnect(mapStateToProps, {startMatchingConversation, changeChat}),\nfirestoreConnect(props => {\n    return [\n        { collection: 'chats' },\n        {\n            collection: \"users\",\n            doc: props.auth.uid,\n            subcollections: [{ collection: \"chat_history\" }],\n            storeAs: \"chat_history\"\n        }\n    ]\n})\n)(MatchingWindow);"]},"metadata":{},"sourceType":"module"}